sudo: required

language: scala

scala:
  - 2.11.8

jdk:
  - oraclejdk8

addons:
  apt:
    packages:
    - build-essential
    - python3-dev
    - python3-pip

cache:
  directories:
    - $HOME/.m2/repository
      # - $HOME/.sbt
      # - $HOME/.ivy2
    - $HOME/.sbt/launchers/

before_script:
  - mkdir -p $HOME/.sbt/launchers/0.13.8/
  - curl -L -o $HOME/.sbt/launchers/0.13.8/sbt-launch.jar https://repo.typesafe.com/typesafe/ivy-releases/org.scala-sbt/sbt-launch/0.13.8/sbt-launch.jar

install:
  - sudo pip3 install --upgrade pip setuptools wheel
  - sudo pip3 install -r requirements.txt
  - python3 setup.py build sdist bdist_wheel
  - sudo pip3 install dist/pyspark3*.whl

script:
  - ./test_python.sh
  - echo "Scala version:" $TRAVIS_SCALA_VERSION
  - sbt ++$TRAVIS_SCALA_VERSION coverage test coverageReport
  # Trick to avoid unnecessary cache updates
  - find $HOME/.sbt -name "*.lock" | xargs rm

after_success:
  - bash <(curl -s https://codecov.io/bash)
